<!doctype html>
<head>
  <title>Offline Web Apps on the iPhone | Boris Smus</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="

In the midst of my graduate studies, I somehow found the time to write a
simple prototype for a mobile Guitar Unleashed client.">

  <!-- Icons -->
  <link rel="icon" type="image/x-icon" href="/static/icons/favicon.ico" />
  <link rel="apple-touch-icon" href="/static/icons/apple-touch-icon.png">

  <!-- Styles -->
  <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:700|PT+Sans|Inconsolata' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/static/stylesheets/screen.css" type="text/css" media="screen" charset="utf-8">

  <!-- Feed -->
  <link href="http://feeds.feedburner.com/smuscom" rel="alternate" title="Boris Smus" type="application/atom+xml"/>
</head>
<body>
  <header>
    <span class="left">
      <a href="/" class="name">Boris Smus</a>
    </span>
    <span class="right">
      <a href="/projects/">Projects</a>
      <a href="/about/">About</a>
      <a href="/archive/posts/">Archives</a>
    </span>
  </header>

  <div id="main">
    <section id="articles">
      
<article>
  <h1><a href="/offline-web-iphone">Offline Web Apps on the iPhone</a></h1>
  <div class="subtitle">
  
  <time>Published on 06 September 2009</time>
  
  
  </div>
  <p>
    <p>In the midst of my graduate studies, I somehow found the time to write a
simple prototype for a mobile Guitar Unleashed client. It's more of a
proof-of-concept for some cool new technologies that I've been meaning
to play with. Two things led me down this path:</p>

<ol>
<li>Since I'm no longer bound by corporate affiliation, I feel compelled
to finally develop an interesting application for iPhone.</li>
<li>I'm very bad at remembering guitar chords and lyrics, but never
bother making a cheat sheet to take to the campfire. I nearly always
have my phone in my pocket, though.</li>
</ol>

<p>The GU mobile prototype is very simple. Users can manage a list of
favorite songs, and view their lyrics with chords. At first, I set out
to create a native iPhone application to do this, but several
considerations made me change my mind:</p>

<ol>
<li>I don't want to deal with a potential App Store rejection, keeping
in mind the dubious legality of lyrics</li>
<li>The simplicity and data-centric nature of the app lends itself well
to a web implementation.</li>
</ol>

<p><img src="phone.png" class="left"></p>

<p>There are a few interesting technical challenges to overcome in implementing
this application. Firstly, the app needs to blend visually with the iPhone look
and feel. I chose the <a href="http://code.google.com/p/iui/">iUI</a> web framework to develop my application. In
retrospect, <a href="http://www.jqtouch.com/">jQTouch</a> would have probably been a better choice, since I ended
up using jQuery. In addition, iUI is very much not bug free, and I don't like
iUI's anchor-based navigation. Apple provides several iPhone-specific meta tags
to enhance the web experience. For example, <code>&lt;link rel="apple-touch-icon"
href="logo-touch-icon.png" /&gt;</code> allows to specify the icon that will appear in
the iPhone springboard. Setting <code>&lt;meta name="apple-touch-fullscreen"
content="YES" /&gt;</code> will remove the lower hud of MobileSafari. The full list of
options is available <a href="http://developer.apple.com/safari/library/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html">from Apple</a>.</p>

<p>The second broad challenge for mine and iPhone web applications in general is
that they need to remain functional without an internet connection. For my
mobile client, data would be provided by two calls returning JSON:
<code>/song/search?query=myQuery</code> returning a list of songs and <code>/song/get/myID</code>
returning specific song info. My first instinct was to implement local
persistence via cookies, as is customary in web development. There's a 4K limit
on the size of each cookie, so storing all songs in one cookie was out of the
question. A simple alternative was to store a cookie with an array of song IDs,
and a cookie for each song. This strategy worked quite well on WebKit and in
the iPhone simulator. Unfortunately, cookie persistence works differently on
the actual iPhone, likely for security reasons. Every time the phone reboots,
MobileSafari's cookie jar is emptied. </p>

<p>The alternative to this is a much more modern approach: <a href="http://webkit.org/blog/126/webkit-does-html5-client-side-database-storage/">HTML5 databases</a>.
WebKit now allows you to store structured data locally in an SQLite database. I
found this approach to work very well on iPhone. The database backend persists
through reboots, as expected. I implemented both storage schemes in separate
files, available for your scrutiny: the class SongJar for cookies in <a href="offline-mobile/jar.js">jar.js</a>
and SongDatabase for HTML5 storage <a href="offline-mobile/database.js">database.js</a>.</p>

<p>The last piece of the puzzle is how to force the web application's source files
to get cached on the iPhone, so that the app remains accessible even when the
phone is offline. This is done with a <a href="http://www.w3.org/TR/2009/WD-html5-20090212/offline.html">cache manifest</a>, also new in HTML5. I
ran into several problems trying to set this up, and would have benefited from
these tips:</p>

<ol>
<li>Reference the manifest from the HTML with
<code>&lt;html manifest="cache-manifest"&gt;</code></li>
<li>Serve the manifest with the <code>text/cache-manifest</code> mime type</li>
<li>Ensure that all paths in the manifest are accessible</li>
</ol>

<p>Though my app is a mere prototype, I'm quite happy with the result.
After adding the application to the springboard, it <em>almost</em> feels like
a first class iPhone application. You can try it out at
<a href="http://www.guitarunleashed.com/m/">http://www.guitarunleashed.com/m/</a>, and please bear in mind that it's
a proof of concept.</p>

  </p>

  <!--
  DISABLED COMMENTS.

  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'smus'; // Required - Replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
  -->
</article>

    </section>
    <aside>
      <img src="/static/images/me.jpg" alt="Headshot of Author" title="Headshot of Author">
      <p>
        I'm Boris Smus, a software engineer and UI prototyper from
        Vancouver, Canada. I currently live in San Francisco and work on
        Chrome related things.
        <a href="/about/" class="readmore"></a>
      </p>
    </aside>
  </div>

  <div id="push"></div>

  <footer>
    <p>
      &copy; 2008 - 2015 Boris Smus<br>
      Powered by <a href="/site/">Lightning</a>
    </p>

    <ul id="social-links">
      <a href="http://feeds.feedburner.com/smuscom" class="social rss" title="RSS" rel="external me">RSS</a>
      <a href="https://github.com/borismus" class="social github" title="GitHub" rel="external me">GitHub</a>
      <a href="https://profiles.google.com/boris.smus" rel="author" class="social plus" title="Google Plus" rel="external me">Google Plus</a>
      <a href="https://twitter.com/borismus" class="social twitter" title="Twitter" rel="external me">Twitter</a>
    </ul>
  </footer>


  <script src="/static/javascripts/highlight.pack.js"></script>
  <script>
    // Syntax highlighting for code.
    hljs.tabReplace = '  ';
    hljs.initHighlightingOnLoad();
  </script>
  <script>
    // Google Analytics.
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-17930798-22', 'smus.com');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>
  <script src="//cdn.webglstats.com/stat.js" defer="defer" async="async"></script>
  <script src="/lightning_error.js"></script>
</body>