<!doctype html>
<head>
  <title>Tweetbacks in JavaScript | Boris Smus</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="

Every new post on this blog gets an unsolicited [pingback][] from
[topsy][], a service that tracks which users mentioned the post on
twitter (known informally as [tweetbacks][]).">

  <!-- Icons -->
  <link rel="icon" type="image/x-icon" href="/static/icons/favicon.ico" />
  <link rel="apple-touch-icon" href="/static/icons/apple-touch-icon.png">

  <!-- Styles -->
  <link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:700|PT+Sans|Inconsolata' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/static/stylesheets/screen.css" type="text/css" media="screen" charset="utf-8">

  <!-- Feed -->
  <link href="http://feeds.feedburner.com/smuscom" rel="alternate" title="Boris Smus" type="application/atom+xml"/>
</head>
<body>
  <header>
    <span class="left">
      <a href="/" class="name">Boris Smus</a>
    </span>
    <span class="right">
      <a href="/projects/">Projects</a>
      <a href="/about/">About</a>
      <a href="/archive/posts/">Archives</a>
    </span>
  </header>

  <div id="main">
    <section id="articles">
      
<article>
  <h1><a href="/tweetbacks-in-javascript">Tweetbacks in JavaScript</a></h1>
  <div class="subtitle">
  
  <time>Published on 16 December 2010</time>
  
  
  </div>
  <p>
    <p>Every new post on this blog gets an unsolicited <a href="http://en.wikipedia.org/wiki/Pingback">pingback</a> from
<a href="http://topsy.com">topsy</a>, a service that tracks which users mentioned the post on
twitter (known informally as <a href="http://tomsucks.wordpress.com/2008/05/27/free-idea-tweetback/">tweetbacks</a>). On one hand, topsy is a
parasite, using sites like mine to rise in search engine rankings, but
on the other, it satisfies this blogger's curiosity to learn who reads
and enjoys my posts enough to tweet about them. In this experiment, I've
exposed tweetbacks directly on this blog using topsy's convenient 
<a href="http://otter.topsy.com">JSONP API</a>.</p>

<p>The implementation is entirely in JavaScript, consisting of two
scripts. The first is on the main post listing, showing the number of
tweets for each post using <code>http://otter.topsy.com/stats.js</code>. The second
is on the post page itself, showing the tweets posted in response to the
post using <code>http://otter.topsy.com/trackbacks.js</code>. Both scripts execute
after the page loads, so the only impact on page load time is the extra
kilobyte of JavaScript code. </p>

<p>There are good reasons to use topsy over <a href="http://search.twitter.com">twitter search</a>, even though
at first glance, they both provide similar information:</p>

<ul>
<li>Twitter search doesn't index old tweets</li>
<li>Topsy distinguishes influential tweets (more on this later)</li>
<li>JSONP API support</li>
</ul>

<p>It's important not to overwhelm readers by showing too many tweets.
Popular blog posts can have hundreds or even thousands of tweets, and
showing all of them at once is a bad idea. Topsy associates an influence
value with each twitter user, giving them a certain weight, making it
easier to decide which tweets to show, and which to hide. My
implementation shows at most N tweets; if there are over N total tweets,
it shows at most N 'influential' tweets, as per topsy's definition.</p>

<pre><code>var MAX_TWEETS = 10;
var BASE = 'http://otter.topsy.com/trackbacks.js?callback=?&amp;perpage=' + 
  MAX_TWEETS;
var ALL = BASE + '&amp;url=';
var INFL = BASE + '&amp;infonly=1&amp;url=';

function getTweets(url) {
  $.getJSON(ALL + url, function(data) {
    var response = data.response;
    if (response.total &gt; MAX_TWEETS) {
      $.getJSON(INFL + url, function(infl) {
        processTweetList(infl.response.list);
        var count = (infl.response.total &gt; MAX_TWEETS ? MAX_TWEETS : infl.response.total);
        updateTweetCount(count, response.total);
      });
    } else if (response.total &gt; 0) {
      processTweetList(response.list);
      updateTweetCount(response.total);
    }
  });
}
</code></pre>

<p>I also urlify the
tweet, converting all of the URLs and @mentions into <a\&gt; elements using
this function, I found the first regular expression somewhere on the
internet â€“ I'd never write such a beast. </p>

<pre><code>var URL_RE = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&amp;@#\/%?=~_|!:,.;]*[-A-Z0-9+&amp;@#\/%=~_|])/ig;
var TWEET_RE = /@([A-Za-z0-9_]+)/g;

function urlify(text) {
  return text.replace(URL_RE,"&lt;a href='$1'&gt;$1&lt;/a&gt;").
              replace(TWEET_RE, "&lt;a href='http://twitter.com/$1'&gt;@$1&lt;/a&gt;");
</code></pre>

<p>The approach I took has some major advantages to over the <a href="http://yoast.com/wordpress/tweetbacks/">tweetback plugin</a> 
for wordpress:</p>

<ul>
<li>It works... the wordpress plugin doesn't</li>
<li>No wordpress comment pollution since no wordpress comments are
created</li>
<li>No server-side load since all comments are fetched in JS</li>
<li>No wordpress required. Other blog engines or static sites work just
as well</li>
</ul>

<p>A drawback of this approach is that it takes some time to run the JS,
which changes the DOM after the initial page load, resulting in a
jarring experience. By using a fade effect to make twitter information
appear gradually, I try to mitigate this problem. </p>

<p>I conclude with a shameless plug: tweetbacks.js is running on this blog,
so try it out by posting a tweet referring to this post's URL, and it
should appear in the list below, or if there are more than 10 tweets, at
least increment the count. If you find this concept interesting and
would like to run it on your site, let me know and I'll pack
tweetbacks.js up into a jQuery plugin or something. Thanks for reading! </p>

<p><strong>Update:</strong> I no longer use this code, in favor of the official twitter
button.</p>

  </p>

  <!--
  DISABLED COMMENTS.

  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'smus'; // Required - Replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
  -->
</article>

    </section>
    <aside>
      <img src="/static/images/me.jpg" alt="Headshot of Author" title="Headshot of Author">
      <p>
        I'm Boris Smus, a software engineer and UI prototyper from
        Vancouver, Canada. I currently live in San Francisco and work on
        Chrome related things.
        <a href="/about/" class="readmore"></a>
      </p>
    </aside>
  </div>

  <div id="push"></div>

  <footer>
    <p>
      &copy; 2008 - 2015 Boris Smus<br>
      Powered by <a href="/site/">Lightning</a>
    </p>

    <ul id="social-links">
      <a href="http://feeds.feedburner.com/smuscom" class="social rss" title="RSS" rel="external me">RSS</a>
      <a href="https://github.com/borismus" class="social github" title="GitHub" rel="external me">GitHub</a>
      <a href="https://profiles.google.com/boris.smus" rel="author" class="social plus" title="Google Plus" rel="external me">Google Plus</a>
      <a href="https://twitter.com/borismus" class="social twitter" title="Twitter" rel="external me">Twitter</a>
    </ul>
  </footer>


  <script src="/static/javascripts/highlight.pack.js"></script>
  <script>
    // Syntax highlighting for code.
    hljs.tabReplace = '  ';
    hljs.initHighlightingOnLoad();
  </script>
  <script>
    // Google Analytics.
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-17930798-22', 'smus.com');
    ga('require', 'displayfeatures');
    ga('send', 'pageview');
  </script>
  <script src="//cdn.webglstats.com/stat.js" defer="defer" async="async"></script>
  <script src="/lightning_error.js"></script>
</body>